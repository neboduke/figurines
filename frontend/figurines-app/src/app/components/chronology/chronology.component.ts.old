import { HttpErrorResponse } from "@angular/common/http";
import { Component, OnInit } from "@angular/core";
import { NgForm } from "@angular/forms";
import { Chronology } from "src/app/entity/chronology";
import { ChronologyService } from "src/app/services/chronology.service";


@Component({
    selector: 'app-chronology',
    templateUrl: './chronology.component.html',
    styleUrls: ['./chronology.component.css']
})
export class ChronologyComponent implements OnInit{
  

    public chronologies: Chronology[] = [];
    public editableChronology: Chronology | undefined;
    

    constructor(private chronologyService: ChronologyService) { }

    ngOnInit(){
        this.getChronologies();
    }

    public getChronologies():void{
        this.chronologyService.getChronologies().subscribe(
             responseData => {
                this.chronologies = responseData;
             },
            (error: HttpErrorResponse) => {
                alert(error.message)
            }
        );
    }

    //getting modal window
    public onOpenModal( target: string , chronology?: Chronology):void {
        this.editableChronology = chronology;
        const container = document.getElementById('chronology_container');
        
        const button = document.createElement('button');
        button.type = 'button';
        button.style.display = 'none';
        button.setAttribute('data-bs-toggle','modal');
        button.setAttribute('data-bs-target', target);

        container?.appendChild(button);
        button.click();
    }

    public onAddChronology(addForm: NgForm): void {
        this.chronologyService.addChronologies(addForm.value).subscribe(
            (response: Chronology) => {
                console.log(response);
                this.getChronologies();
                document.getElementById('disadd')?.click();
                addForm.reset();
            },
            (error: HttpErrorResponse) => {
                alert(error.message);
                addForm.reset();
            }
        )
    }

    public onEditChronology(chronology: Chronology): void {
        alert('---EDIT---')
      /*  this.chronologyService.updateChronologies(chronology).subscribe(
            (response: Chronology) => {
                console.log(response);
                this.getChronologies();
            },
            (error: HttpErrorResponse) => {
                alert(error.message);
            }
        )*/
    }

    public onRemoveChronology(chronologyId?: number): void {
        alert('---REMOVE---')
        /*  this.chronologyService.deleteChronologies(chronologyId).subscribe(
            (response: void) => {
                console.log(response);
                this.getChronologies();
            },
            (error: HttpErrorResponse) => {
                alert(error.message);
            }
        )*/
    }
    
}